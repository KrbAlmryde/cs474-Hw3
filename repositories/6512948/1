From d9ef58c58195d7836d5a3a63765db0a219134557 Mon Sep 17 00:00:00 2001
From: fomojola <oluseyi@alum.mit.edu>
Date: Sun, 11 Nov 2012 22:58:50 -0500
Subject: [PATCH] Fixed the login to properly receive information about the
 current couple.


1	1	.classpath
-	-	libs/android-hipmob-1.0-beta-12.jar
-	-	libs/android-hipmob.jar
20	17	src/com/hipmob/android/couple/CoupleLogin.java
 create mode 100644 libs/android-hipmob-1.0-beta-12.jar
 delete mode 100644 libs/android-hipmob.jar

diff --git a/.classpath b/.classpath
index e3ff21d..dba25a8 100644
--- a/.classpath
+++ b/.classpath
@@ -5,8 +5,8 @@
 	<classpathentry kind="con" path="com.android.ide.eclipse.adt.ANDROID_FRAMEWORK"/>
 	<classpathentry kind="con" path="com.android.ide.eclipse.adt.LIBRARIES"/>
 	<classpathentry kind="lib" path="libs/android-support-v13.jar"/>
-	<classpathentry kind="lib" path="libs/android-hipmob.jar" sourcepath="/hipmob"/>
 	<classpathentry kind="lib" path="libs/gcm.jar"/>
 	<classpathentry kind="lib" path="libs/MixpanelAPI_v2.1.jar"/>
+	<classpathentry kind="lib" path="libs/android-hipmob-1.0-beta-12.jar"/>
 	<classpathentry kind="output" path="bin/classes"/>
 </classpath>
diff --git a/libs/android-hipmob-1.0-beta-12.jar b/libs/android-hipmob-1.0-beta-12.jar
new file mode 100644
index 0000000..bed6e29
Binary files /dev/null and b/libs/android-hipmob-1.0-beta-12.jar differ
diff --git a/libs/android-hipmob.jar b/libs/android-hipmob.jar
deleted file mode 100644
index bed6e29..0000000
Binary files a/libs/android-hipmob.jar and /dev/null differ
diff --git a/src/com/hipmob/android/couple/CoupleLogin.java b/src/com/hipmob/android/couple/CoupleLogin.java
index ba9ba02..9f1abb2 100644
--- a/src/com/hipmob/android/couple/CoupleLogin.java
+++ b/src/com/hipmob/android/couple/CoupleLogin.java
@@ -171,11 +171,7 @@ public class CoupleLogin extends Activity implements OnClickListener
 						m.obj = detail.getString("error");
 					}else if(detail.has("guid") && detail.has("name")){
 						m.what = SUCCESS;
-						if(detail.has("partner")){
-							m.obj = new String[]{ detail.getString("guid"), detail.getString("name"), detail.getString("partner") };
-						}else{
-							m.obj = new String[]{ detail.getString("guid"), detail.getString("name") };
-						}
+						m.obj = detail;
 					}
 				}
 			}catch(JSONException jse){
@@ -210,25 +206,32 @@ public class CoupleLogin extends Activity implements OnClickListener
 		
 	}
 	
-	private void success(String[] results)
+	private void success(JSONObject results)
 	{
 		// done
 		String email = emailInput.getText().toString().trim();
 		removeDialog(DIALOG_LOGGING_IN);
 
+		JSONObject props = new JSONObject();
+		
 		// save the guid to the preferences
 		SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(getBaseContext());
 		SharedPreferences.Editor edit = prefs.edit();
-		edit.putString(getString(R.string.pref_guid), results[0]);
-		edit.putString(getString(R.string.pref_name), results[1]);
-		edit.putString(getString(R.string.pref_email), email);
-		if(results.length > 2) edit.putString(getString(R.string.pref_coupled), results[2]);
-		edit.commit();
-
-		JSONObject props = new JSONObject();
-		try{
-			props.put("guid", results[0]);
-			props.put("name", results[1]);
+		try{			
+			edit.putString(getString(R.string.pref_guid), results.getString("guid"));
+			edit.putString(getString(R.string.pref_name), results.getString("name"));
+			edit.putString(getString(R.string.pref_email), email);
+			
+			if(results.has("partnerName")){
+				edit.putString(getString(R.string.pref_coupled), results.getString("partnerEmail"));
+				edit.putString(getString(R.string.pref_partner), results.getString("partnerGuid"));
+				edit.putString(getString(R.string.pref_partner_name), results.getString("partnerName"));
+				edit.putString(getString(R.string.pref_coupled_guid), results.getString("requestGuid"));
+			}		
+			edit.commit();
+	
+			props.put("guid", results.getString("guid"));
+			props.put("name", results.getString("name"));
 			props.put("email", email);
 		}catch(Exception e1){}
 		mMixpanel.track("Login", props);
@@ -250,7 +253,7 @@ public class CoupleLogin extends Activity implements OnClickListener
 		{
 			switch (msg.what){
 			case SUCCESS:
-				success((String[])msg.obj);
+				success((JSONObject)msg.obj);
 				break;
 			case FAILURE:
 				failure(msg.obj.toString());
-- 
2.8.4 (Apple Git-73)

